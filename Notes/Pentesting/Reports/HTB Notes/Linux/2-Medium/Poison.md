## Takeaway
- This box is more `CTF-like` but did give a tour of `VNC` if not already familiar.
## Metadata
- `http://10.10.10.84/browse.php?file=listfiles.php` will reveal `pwdbackup.txt` which contains the base64 encoded password.![[Pasted image 20231230142801.png]]
	- Using a small python script, we can decode cipher text and retrieve the password as `Charix!2#4%6&8(0`![[Pasted image 20231230150044.png]]
- If you really pay attention, you can see that the `browse.php` is vulnerable to LFI and one of the local user is `charix` which seems corresponds to the password above.![[Pasted image 20231230143339.png]]However, there are also several unintended ways to gain shells on victim machine as `www-data`:
	- The idea behind is that as long as we can write contents to certain files on the victim, LFI (`include()` in the case here) can always achieve RCE.
	- With `phpinfo.php`, `file_uploads` enabled, and LFI, one can achieve [RCE](https://book.hacktricks.xyz/pentesting-web/file-inclusion/lfi2rce-via-phpinfo). (<mark>Verified it works! Modified script in my Kali Box `htb/10.10.10.84/exploit`</mark>)
	- With apache Log Poisoning and LFI, one can also achieve RCE.
- Using `netstat`, one can identify `VNC` is listening on port 5801 and 5901 of local address. ![[Pasted image 20231230155629.png]]
	- Moreover, `VNC` is running by the `root` user. Given all `VNC` clients `root` level access as well.![[Pasted image 20231230162108.png]]
- There is a `secret.zip` on `charix`'s home folder. The same login password `Charix!2#4%6&8(0`  can be used to unzip the file. However, the unzip `secret` is a binary file with 8 bytes. Give that VNC is also running, it could be the VNC password, which we can decode ([why](https://book.hacktricks.xyz/network-services-pentesting/pentesting-vnc)).
	- We do need a bit tunneling to reach `VNC` server since it is listening on local address. 
	- Decode `secret` binary file with `VNC` [password decoding tool](https://github.com/jeroennijhof/vncpwd) to get `VNC` password as `VNCP@$$!`(Does not really need for the challenge but a good to know here).                                               ![[Pasted image 20231230161031.png]]
#### Attack Path
- <mark>Exploitation</mark>
	- Login as through SSH as `charix` using password `Charix!2#4%6&8(0`.
	- ![[Pasted image 20231230150435.png]]
- <mark>Post-Exploitation</mark>
	- Retrieve the `secret.zip` and unzip with password `Charix!2#4%6&8(0` to get the `secret` binary file.
	- <mark>Tunneling</mark>
		- Use `SSH` local port forwarding. Run `ssh -N -L 5901:127.0.0.1:5901 charix@10.10.10.84`.
	- <mark>VNC Session</mark>
		- Connect to the tunnel to establish `VNC` session with command `vncviewer 127.0.0.1::5901 -passwd secret`.
		- ![[Pasted image 20231230163945.png]]