## Takeaway
## Metadata
- Port `80` is redirected to `set-config.php` to set up `wordpress` site. Hence, I can force the site to set up with `MySQL` database under my control so that I get administrator access to entire site.
- Enumerate as `www-data`, one can find there is a `eXtplorer` instance running `http://192.168.240.16/filemanager/index.php`![[Pasted image 20240323203228.png]]![[Pasted image 20240323203125.png]]
	- Default credential pair `admin:admin` works.
- After login `eXtplorer` as `Administrator`, we will be prompted that there is another user `dora`.![[Pasted image 20240324123048.png]]
	- Within `/filemanager/config/.htusers.php`, one can find password hash for user `dora`.![[Pasted image 20240324123748.png]]
	- Run `hashcat -m 3200 dora.hash /usr/share/wordlists/rockyou.txt --force` to obtain plaintext credential pair as `dora:doraemon`![[Pasted image 20240324124218.png]]
- Enumerating as `dora`, one will notice that the user is part of the `Disk Group` which basically mean full-read but not necessarily write privilege over the entire file system.![[Pasted image 20240324130949.png]]
	- https://book.hacktricks.xyz/linux-hardening/privilege-escalation/interesting-groups-linux-pe
# Exploitation
## Shell as www-data
- Login with `admin:admin` which I configured during set up. Upload `rev.php` at `http://192.168.240.16/wp-admin/plugin-install.php`.![[Pasted image 20240323200841.png]]
	- The upload will fail but we can find the payload at `http://192.168.240.16/wp-admin/upload.php`.![[Pasted image 20240323201100.png]]
	- Navigate to `http://192.168.240.16/wp-content/uploads/2024/03/rev.php` to get a reverse shell call back at `www-data`.
## Shell as dora
- Within the shell of `www-data`, run `su dora` and enter password `doraemon` to obtain the session as `dora`.
# PrivEsc
- Run `df -h` first to find where `/` is mounted on.![[Pasted image 20240324131140.png]]
- Run `debugfs /dev/mapper/ubuntu--vg-ubuntu--lv` to debug the filesystem.
	- Within the session, run `cat /etc/shadow` to retrieve password hash for the user `root`.![[Pasted image 20240324131325.png]]
	- Run `hashcat -m 1800 root.hash /usr/share/wordlists/rockyou.txt --force` to retrieve the credential pair in plaintext as `root:explorer`.![[Pasted image 20240324131412.png]]
	- Run `su` and enter password `explorer` to switch to the root account.